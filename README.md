
# Attention Sampling - Pytorch
This is a PyTorch implementation of the the paper: ["Processing Megapixel Images with Deep Attention-Sampling Models"](https://arxiv.org/abs/1905.03711). This repository is based on the [original repository](https://github.com/idiap/attention-sampling) belonging to this paper which is written in TensorFlow.

## Porting to PyTorch
The code from the original repository has been rewritten to to a PyTorch 1.4.0 implementation. The most difficult part was rewriting the functions that extract the patches from the high resolution image. The original version uses special C/C++ files for this, I have done this in native Python. This is probably more inefficient and slower because it requires a nested for-loop. I tested with performing the patch extraction in parallel but this adds so much overhead that it is actually slower. 

Furthermore, I hope I implemented the part where the expectation is calculated correctly. This uses a custom `backward()` function and I hope there are no bugs in it. 

##  Performance
This code repository has been tested on two of the tasks mentioned in the original paper: the Mega-MNIST and the traffic sign detection task. This code base yields comparable results on both tasks. However, the traffic sign detection task requires approximately twice as many epochs to achieve similar results. These experiments can be run by running `mega_mnist.py` and `speed_limits.py`.

## Installation
Dependencies can be found inside the `requirements.txt` file. To install, run `pip3 install -r requirements.txt`. This code repository defaults to running on a GPU if it is available. It has been tested on both CPU and GPU.

## Questions and contributions
If you have any question about the code or methods used in this repository you can reach out to joris.mollinga@surfsara.nl. If you find bugs in this code (which could be possible) please also contact me or file an issue. If you want to contribute to this code my making it more efficient (for example, the patch extraction procedure is quite inefficient) please contact me or submit a pull request. 

## Research
If this repository has helped you in your research we would value to be acknowledged in your publication.

# Acknowledgement
This project has received funding from the European Unionâ€™s Horizon 2020 research and innovation programme under grant agreement No 825292. This project is better known as the ExaMode project. The objectives of the ExaMode project are:
1. Weakly-supervised knowledge discovery for exascale medical data.  
2. Develop extreme scale analytic tools for heterogeneous exascale multimodal and multimedia data.  
3. Healthcare & industry decision-making adoption of extreme-scale analysis and prediction tools.

For more information on the ExaMode project, please visit www.examode.eu. 
![enter image description here](https://www.examode.eu/wp-content/uploads/2018/11/horizon.jpg) ![enter image description here](https://www.examode.eu/wp-content/uploads/2018/11/flag_yellow.png)![enter image description here](data:image/png;base64,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 =46x)


